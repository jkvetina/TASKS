const draggables=document.querySelectorAll(".TASK"),droppables=document.querySelectorAll(".TARGET");draggables.forEach((e=>{e.addEventListener("dragstart",(()=>{e.classList.add("DRAGGING")})),e.addEventListener("dragend",(t=>{e.classList.remove("DRAGGING");var r=[],o=t.target.parentElement.getAttribute("id"),s=t.target.parentElement.parentElement.getAttribute("id");const n=0===o.indexOf("TASK_")?s:o,l=e.getAttribute("id").replace("TASK_",""),a=n.replace("STATUS_","").split("_SWIMLANE_")[0],c=n.replace("STATUS_","").split("_SWIMLANE_")[1];document.getElementById(n).querySelectorAll(".TASK").forEach((function(e){r.push(e.getAttribute("id").replace("TASK_",""))})),r=r.join(":"),console.group("TASK_MOVED"),console.log("TASK     :",l),console.log("TARGET   :",n,o,s),console.log("STATUS   :",a),console.log("SWIMLANE :",c),console.log("SORTED   :",r),console.groupEnd(),apex.server.process("UPDATE_TASK",{x01:l,x02:a,x03:c,x04:r},{dataType:"text",success:function(e){console.log("RESULT",e),e.indexOf("sqlerrm")>=0?apex.message.showErrors([{type:"error",location:["page","inline"],pageItem:"",message:e.split("sqlerrm:")[1],unsafe:!1}]):apex.message.showPageSuccess(e)}})}))})),droppables.forEach((e=>{e.addEventListener("dragover",(t=>{t.preventDefault();const r=document.querySelector(".DRAGGING"),o=insertAboveTask(e,t.clientY);r?e.insertBefore(r,o):e.appendChild(r)}))}));const insertAboveTask=(e,t)=>{const r=e.querySelectorAll(".TASK:not(.DRAGGING)");let o=null,s=Number.NEGATIVE_INFINITY;return r.forEach((e=>{const{top:r}=e.getBoundingClientRect(),n=t-r;n<0&&n>s&&(s=n,o=e)})),o};